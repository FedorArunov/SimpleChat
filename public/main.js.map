{"version":3,"file":"main.js","sources":["../src/Messages.js","../src/chat-box/Box.js","../src/Server.js","../src/App.js","../index.js"],"sourcesContent":["var Messages = function (container) {\r\n    this._container = container;\r\n    this.render = this.render.bind(this);\r\n};\r\nMessages.prototype.constructor = Messages;\r\nMessages.prototype.render = function (items) {\r\n    this._container.innerHTML = items.map(function(item) {\r\n        var author = item.author;\r\n        var content = item.content;\r\n        var updated = (new Date (item.updated)).toLocaleString();\r\n        return ['<div class=\"message-item\">',\r\n            '<div class=\"message-time\">', updated, '</div>',\r\n            '<div class=\"message-author\">', author, '</div>',\r\n            '<div class=\"message-text\">', content, '</div>',\r\n        '</div>'].join(' ');\r\n    }).join('');        \r\n};\r\n\r\nmodule.exports = Messages;\r\n","var Box = function (container) {\r\n    this._container = container;\r\n    this._container.innerHTML = '<textarea></textarea>';\r\n    this._container.querySelector('textarea').addEventListener ('keydown', this.keyHandler.bind(this));\r\n};\r\nBox.prototype.constructor = Box;\r\nBox.prototype.keyHandler = function (e) {\r\n    if (typeof this.onSend === 'function' && e.keyCode === 13 && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var text = this._container.querySelector('textarea');                        \r\n        this.onSend(text.value);\r\n        text.value = '';\r\n    }\r\n};\r\nmodule.exports = Box;","function get_messages () {\r\n    return fetch ('messages')\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nfunction add_message (author, content) {\r\n    return fetch ('messages', {\r\n        method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify({author, content})\r\n    })\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nfunction add_user (login) {\r\n    return fetch ('users', {\r\n        method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify({login})\r\n    })\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nmodule.exports = {get_messages: get_messages, add_message: add_message, add_user: add_user};","var Messages = require('./Messages.js');\r\nvar Box = require('./chat-box');\r\nvar Server = require('./Server.js');\r\n\r\nvar App = function (container) {\r\n    \r\n    this.refresh = this.refresh.bind(this);\r\n    this.resize = this.resize.bind(this);\r\n\r\n    this._container = container;\r\n    this._container.innerHTML = [\r\n        '<div class=\"header\"></div>',\r\n        '<div class=\"wrapper\">',\r\n            '<div class=\"content\">',\r\n                '<div class=\"messages\"></div>',\r\n                '<div class=\"messages-input\"></div>',\r\n            '</div>',\r\n            '<div class=\"sidebar\">',\r\n                '<div class=\"sidebar-menu\"></div>',\r\n                '<div class=\"sidebar-users\"></div>',\r\n            '</div>',\r\n        '</div>',\r\n        '<div class=\"footer\"></div>',\r\n    ].join('');\r\n    \r\n    this._messages = new Messages (this._container.querySelector('.messages'));\r\n    this._box = new Box (this._container.querySelector('.messages-input'));\r\n    this._box.onSend = this.addMessage.bind(this);                \r\n    window.addEventListener ('resize', this.resize);\r\n    this.refresh();\r\n    this.resize();\r\n};\r\n\r\nApp.prototype.constructor = App;\r\nApp.prototype.refresh = function () {\r\n    Server.get_messages()\r\n    .then (this._messages.render)\r\n    .catch (function (e) { console.log (e); });\r\n};\r\nApp.prototype.resize = function () {\r\n    var containerHeight = this._container.getBoundingClientRect().height;\r\n    var headerHeight = this._container.querySelector('.header').getBoundingClientRect().height;        \r\n    var footerHeight = this._container.querySelector('.footer').getBoundingClientRect().height;        \r\n    var boxHeight = this._container.querySelector('.messages-input').getBoundingClientRect().height;\r\n    var h = ''.concat(containerHeight - headerHeight - boxHeight - footerHeight, 'px');\r\n    var messages = this._container.querySelector('.messages');\r\n    messages.style.maxHeight = h;\r\n    messages.style.height = h;    \r\n};\r\nApp.prototype.addMessage = function (content) {\r\n    Server.add_message (0, content)\r\n    .then (this.refresh)\r\n    .catch (function (e) {\r\n        console.log(e);\r\n    });\r\n};\r\n\r\nmodule.exports = App;","var App = require ('./src/App.js');\r\n\r\nvar app = new App(document.getElementById('app'));"],"names":["Messages","Box","App"],"mappings":"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"}