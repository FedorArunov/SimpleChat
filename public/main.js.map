{"version":3,"file":"main.js","sources":["../src/Messages/Messages.js","../src/Box/Box.js","../src/Server.js","../src/App/App.js","../index.js"],"sourcesContent":["require ('./Messages.css');\r\n\r\nvar Messages = function (container) {\r\n    this._container = container;\r\n    this.render = this.render.bind(this);\r\n};\r\nMessages.prototype.constructor = Messages;\r\nMessages.prototype.render = function (items) {\r\n    this._container.innerHTML = items.map(function(item) {\r\n        var author = item.author;\r\n        var content = item.content;\r\n        var updated = (new Date (item.updated)).toLocaleString();\r\n        return ['<div class=\"message-item\">',\r\n            '<div class=\"message-time\">', updated, '</div>',\r\n            '<div class=\"message-author\">', author, '</div>',\r\n            '<div class=\"message-text\">', content, '</div>',\r\n        '</div>'].join(' ');\r\n    }).join('');        \r\n};\r\n\r\nmodule.exports = Messages;\r\n","require ('./Box.css');\r\n\r\nvar Box = function (container) {\r\n    this._container = container;\r\n    this._container.classList.add('input-box');\r\n    this._container.innerHTML = '<textarea></textarea>';\r\n    this._container.querySelector('textarea').addEventListener ('keydown', this.keyHandler.bind(this));\r\n};\r\nBox.prototype.constructor = Box;\r\nBox.prototype.keyHandler = function (e) {\r\n    if (typeof this.onSend === 'function' && e.keyCode === 13 && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var text = this._container.querySelector('textarea');                        \r\n        this.onSend(text.value);\r\n        text.value = '';\r\n    }\r\n};\r\nmodule.exports = Box;","function get_messages () {\r\n    return fetch ('messages')\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nfunction add_message (author, content) {\r\n    return fetch ('messages', {\r\n        method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify({author, content})\r\n    })\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nfunction add_user (login) {\r\n    return fetch ('users', {\r\n        method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        },\r\n        body: JSON.stringify({login})\r\n    })\r\n    .then (function (response) {\r\n        return response.json();\r\n    });\r\n}\r\n\r\nmodule.exports = {get_messages: get_messages, add_message: add_message, add_user: add_user};","require('./App.css');\r\n\r\nvar Messages = require('../Messages');\r\nvar Box = require('../Box');\r\nvar Server = require('../Server.js');\r\n\r\nvar App = function (container) {\r\n    \r\n    this.refresh = this.refresh.bind(this);\r\n    this.resize = this.resize.bind(this);\r\n\r\n    this._container = container;\r\n    this._container.innerHTML = [\r\n        '<div class=\"header\"></div>',\r\n        '<div class=\"wrapper\">',\r\n            '<div class=\"content\">',\r\n                '<div class=\"messages\"></div>',\r\n                '<div class=\"messages-input\"></div>',\r\n            '</div>',\r\n            '<div class=\"sidebar\">',\r\n                '<div class=\"sidebar-menu\"></div>',\r\n                '<div class=\"sidebar-users\"></div>',\r\n            '</div>',\r\n        '</div>',\r\n        '<div class=\"footer\"></div>',\r\n    ].join('');\r\n    \r\n    this._messages = new Messages (this._container.querySelector('.messages'));\r\n    this._box = new Box (this._container.querySelector('.messages-input'));\r\n    this._box.onSend = this.addMessage.bind(this);                \r\n    window.addEventListener ('resize', this.resize);\r\n    this.refresh();\r\n    this.resize();\r\n};\r\n\r\nApp.prototype.constructor = App;\r\nApp.prototype.refresh = function () {\r\n    Server.get_messages()\r\n    .then (this._messages.render)\r\n    .catch (function (e) { console.log (e); });\r\n};\r\nApp.prototype.resize = function () {\r\n    var containerHeight = this._container.getBoundingClientRect().height;\r\n    var headerHeight = this._container.querySelector('.header').getBoundingClientRect().height;        \r\n    var footerHeight = this._container.querySelector('.footer').getBoundingClientRect().height;        \r\n    var boxHeight = this._container.querySelector('.messages-input').getBoundingClientRect().height;\r\n    var h = ''.concat(containerHeight - headerHeight - boxHeight - footerHeight, 'px');\r\n    var messages = this._container.querySelector('.messages');\r\n    messages.style.maxHeight = h;\r\n    messages.style.height = h;    \r\n};\r\nApp.prototype.addMessage = function (content) {\r\n    Server.add_message (0, content)\r\n    .then (this.refresh)\r\n    .catch (function (e) {\r\n        console.log(e);\r\n    });\r\n};\r\n\r\nmodule.exports = App;","var App = require ('./src/App');\r\nmodule.exports = new App(document.getElementById('app'));"],"names":["Messages","container","this","_container","render","bind","prototype","constructor","items","innerHTML","map","item","author","content","Date","updated","toLocaleString","join","Box","classList","add","querySelector","addEventListener","keyHandler","e","onSend","keyCode","shiftKey","preventDefault","text","value","get_messages","fetch","then","response","json","add_message","method","headers","Content-Type","Accept","body","JSON","stringify","add_user","login","App","refresh","resize","_messages","_box","addMessage","window","Server","catch","console","log","containerHeight","getBoundingClientRect","height","headerHeight","footerHeight","boxHeight","h","concat","messages","style","maxHeight","document","getElementById"],"mappings":"mHAEA,IAAIA,EAAW,SAAUC,GACrBC,KAAKC,WAAaF,EAClBC,KAAKE,OAASF,KAAKE,OAAOC,KAAKH,SAE1BI,UAAUC,YAAcP,IACxBM,UAAUF,OAAS,SAAUI,GAClCN,KAAKC,WAAWM,UAAYD,EAAME,IAAI,SAASC,GAC3C,IAAIC,EAASD,EAAKC,OACdC,EAAUF,EAAKE,QAEnB,MAAO,CAAC,6BACJ,6BAFU,IAAKC,KAAMH,EAAKI,SAAUC,iBAEG,SACvC,+BAAgCJ,EAAQ,SACxC,6BAA8BC,EAAS,SAC3C,UAAUI,KAAK,OAChBA,KAAK,KAGZ,MAAiBjB,uBClBjB,IAAIkB,EAAM,SAAUjB,GAChBC,KAAKC,WAAaF,EAClBC,KAAKC,WAAWgB,UAAUC,IAAI,aAC9BlB,KAAKC,WAAWM,UAAY,wBAC5BP,KAAKC,WAAWkB,cAAc,YAAYC,iBAAkB,UAAWpB,KAAKqB,WAAWlB,KAAKH,UAE5FI,UAAUC,YAAcW,IACxBZ,UAAUiB,WAAa,SAAUC,GACjC,GAA2B,mBAAhBtB,KAAKuB,QAAuC,KAAdD,EAAEE,UAAmBF,EAAEG,SAAU,CACtEH,EAAEI,iBACF,IAAIC,EAAO3B,KAAKC,WAAWkB,cAAc,YACzCnB,KAAKuB,OAAOI,EAAKC,OACjBD,EAAKC,MAAQ,KAGrB,MAAiBZ,ECkBjB,MAAiB,CAACa,aAnClB,WACI,OAAOC,MAAO,YACbC,KAAM,SAAUC,GACb,OAAOA,EAASC,UAgCsBC,YA5B9C,SAAsBxB,EAAQC,GAC1B,OAAOmB,MAAO,WAAY,CACtBK,OAAQ,MACRC,QAAS,CACLC,eAAgB,mBAChBC,OAAU,oBAEdC,KAAMC,KAAKC,UAAU,CAAC/B,OAAAA,EAAQC,QAAAA,MAEjCoB,KAAM,SAAUC,GACb,OAAOA,EAASC,UAkBgDS,SAdxE,SAAmBC,GACf,OAAOb,MAAO,QAAS,CACnBK,OAAQ,MACRC,QAAS,CACLC,eAAgB,mBAChBC,OAAU,oBAEdC,KAAMC,KAAKC,UAAU,CAACE,MAAAA,MAEzBZ,KAAM,SAAUC,GACb,OAAOA,EAASC,gBCzBxB,IAAIW,EAAM,SAAU7C,GAEhBC,KAAK6C,QAAU7C,KAAK6C,QAAQ1C,KAAKH,MACjCA,KAAK8C,OAAS9C,KAAK8C,OAAO3C,KAAKH,MAE/BA,KAAKC,WAAaF,EAClBC,KAAKC,WAAWM,UAAY,CACxB,6BACA,wBACI,wBACI,+BACA,qCACJ,SACA,wBACI,mCACA,oCACJ,SACJ,SACA,8BACFQ,KAAK,IAEPf,KAAK+C,UAAY,IAAIjD,EAAUE,KAAKC,WAAWkB,cAAc,cAC7DnB,KAAKgD,KAAO,IAAIhC,EAAKhB,KAAKC,WAAWkB,cAAc,oBACnDnB,KAAKgD,KAAKzB,OAASvB,KAAKiD,WAAW9C,KAAKH,MACxCkD,OAAO9B,iBAAkB,SAAUpB,KAAK8C,QACxC9C,KAAK6C,UACL7C,KAAK8C,mBAGL1C,UAAUC,YAAcuC,IACxBxC,UAAUyC,QAAU,WACpBM,EAAOtB,eACNE,KAAM/B,KAAK+C,UAAU7C,QACrBkD,MAAO,SAAU9B,GAAK+B,QAAQC,IAAKhC,QAEpClB,UAAU0C,OAAS,WACnB,IAAIS,EAAkBvD,KAAKC,WAAWuD,wBAAwBC,OAC1DC,EAAe1D,KAAKC,WAAWkB,cAAc,WAAWqC,wBAAwBC,OAChFE,EAAe3D,KAAKC,WAAWkB,cAAc,WAAWqC,wBAAwBC,OAChFG,EAAY5D,KAAKC,WAAWkB,cAAc,mBAAmBqC,wBAAwBC,OACrFI,EAAI,GAAGC,OAAOP,EAAkBG,EAAeE,EAAYD,EAAc,MACzEI,EAAW/D,KAAKC,WAAWkB,cAAc,aAC7C4C,EAASC,MAAMC,UAAYJ,EAC3BE,EAASC,MAAMP,OAASI,KAExBzD,UAAU6C,WAAa,SAAUtC,GACjCwC,EAAOjB,YAAa,EAAGvB,GACtBoB,KAAM/B,KAAK6C,SACXO,MAAO,SAAU9B,GACd+B,QAAQC,IAAIhC,MCtDH,ID0DAsB,EC1DQsB,SAASC,eAAe"}